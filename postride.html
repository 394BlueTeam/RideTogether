<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">
<html>
    <head>
        <!-- files to be loaded first -->
        <link href='http://fonts.googleapis.com/css?family=Just+Me+Again+Down+Here|Open+Sans' rel='stylesheet' type='text/css' />
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <title>RideTogether</title>
        <script type='application/javascript' src='JS/fastclick.js'></script>
        <link href="CSS/mobile.css" rel="stylesheet" media="handheld,only screen and (max-device-width:480px)" />
        <link href="CSS/core.css" rel="stylesheet" media="screen" />
        <link rel="stylesheet" href="Plugins/FontAwesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="Plugins/Bootstrap/css/bootstrap.min.css">
        <script type="text/javascript" src="Plugins/Bootstrap/js/bootstrap.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
        <script type="text/javascript" src="JS/autocomplete.js"></script>
        <script type="text/javascript">
            Parse.initialize("b0jfwJsQkNWPdoKnDgd8KJLufCLWNJpmc5vBTkqr", "X90Jzs3gzKceNOdkFmCle8ZiwsE0HGhyNF4N3Wcj");
            var Ride = Parse.Object.extend("Ride");
            
            function enroll(frm){
              if (frm.txtName.value == "")
                  alert("Required field");
              else if (frm.txtOpenSeats.value == "")
                  alert("Required field");
              else {
                  console.log(frm.date.value);
                  var date = new Date(frm.date.value);

                  var startPoint = new Parse.GeoPoint({
                                       latitude: parseFloat(frm.txtStartPointLat.value),
                                       longitude: parseFloat(frm.txtStartPointLng.value)
                                   });
                  var endPoint = new Parse.GeoPoint({
                                     latitude: parseFloat(frm.txtEndPointLat.value),
                                     longitude: parseFloat(frm.txtEndPointLng.value)
                                   });
  
                  var durationRes, departureRes;
                  var durationStr = frm.txtDurationTime.value;
                  var departureStr = frm.txtDepartureTime.value;

                  durationRes = durationStr.split(":");
                  departureRes = departureStr.split(":");

                  var rideposter = new Ride();
                  rideposter.save({ Name: frm.txtName.value,
                                    OpenSeats: Number(frm.txtOpenSeats.value),
                                    TravelTime: frm.txtDepartureTime.value,
                                    Email: frm.txtEmail.value,
                                    StartAddress: frm.txtStartAddress.value, 
                                    StartPoint: startPoint, 
                                    Destination: frm.txtDestination.value,
                                    EndPoint: endPoint,
                                    DepartureTimeHR : Number(departureRes[0]),
                                    DepartureTimeMin : Number(departureRes[1]),
                                    DurationTimeHR : Number(durationRes[0]),
                                    DurationTimeMin : Number(durationRes[1]),
                                    DepartureAMPM : frm.durselect.value,
                                    Date: date}, {
                      success: function(rideposter){
                          console.log("Save succeeded");
                          alert('Thank you! the ride information is posted');
                      },
                      error: function(rideposter, error){
                          console.log("Save failed with error: ", error);
                      }
                  });
              }
            }

            window.addEventListener('load', function() {
                FastClick.attach(document.body);
            }, false);
        </script>
    </head>

    <body class="fancy"> 
        
        <!-- HEADER -->
        <div class="header">
          <h1>Post Your Ride
            <span>
              <a href="javascript:history.back()" id="back"><i class="fa fa-chevron-left fa-lg"></i></a>
              <!-- <a href="#" id="menu"><i class="fa fa-bars fa-lg"></i></a> -->
            </span>
          </h1>     
        </div>

        <!-- POST RIDE FORM -->
        <div class="signup">
            <form class="form-horizontal" role="form">
                <!-- name -->
                <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">Name</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="name" name="txtName" placeholder="Name">
                    </div>
                </div>

                <!-- open seats -->
                <div class="form-group">
                    <label for="seats" class="col-sm-2 control-label" id="openseats">Open Seats</label>
                    <div class="col-xs-6">
                      <select class="form-control" id="seats" name="txtOpenSeats">
                        <option>Open Seats</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                      </select>
                    </div>
                </div>
                
                <!-- start address -->
                <div class="form-group">
                    <label for="start" class="col-sm-2 control-label">Start Address</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="start" name="txtStartAddress" placeholder="ex: 2255 Ridge Ave, Plex, Tech, etc">
                      <input type="hidden" class="form-control" id="startpointlat" name="txtStartPointLat">
                      <input type="hidden" class="form-control" id="startpointlng" name="txtStartPointLng">
                    </div>
                </div>

                <!-- destination -->
                <div class="form-group">
                    <label for="end" class="col-sm-2 control-label">Destination</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="end" name="txtDestination" placeholder="ex: O'Hare, Old Orchard, etc">
                      <input type="hidden" class="form-control" id="endpointlat" name="txtEndPointLat">
                      <input type="hidden" class="form-control" id="endpointlng" name="txtEndPointLng">
                    </div>
                </div>

                <!-- Departure time -->
                <div class="form-group">
                    <label for="departuretime" class="col-sm-2 control-label">Departure Time</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="departuretime" name="txtDepartureTime" placeholder="ex: 1:00">
                      <select class="form-control" id="durselect" name="durselect">
                        <option value="AM">AM</option>
                        <option value="PM">PM</option>
                      </select>
                    </div>
                </div>

                <!-- trip duration -->
                <div class="form-group">
                    <label for="durationtime" class="col-sm-2 control-label">Trip Duration</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="durationtime" name="txtDurationTime" placeholder="How long are you going to spend at your destination? ex. 2:30">
                    </div>
                </div>

                <!-- date -->
                <div class="form-group">
                    <label for="date" class="col-sm-2 control-label">Trip Date</label>
                    <div class="col-sm-10">
                      <input type="date" class="form-control" id="date" name="date" placeholder="Enter trip date">
                    </div>
                </div>
                
                <!-- email -->
                <div class="form-group">
                    <label for="email" class="col-sm-2 control-label">Email</label>
                    <div class="col-sm-10">
                      <input type="email" class="form-control" id="email" name="txtEmail" placeholder="Email">
                    </div>
                </div>

                <!-- submit button -->
                <div class="form-group">
                  <div class="col-sm-offset-2 col-sm-10">
                    <input type="button" class="btn btn-default" onClick="enroll(this.form)" value="Post it!">
                  </div>
                </div>
            </form>
      </div>
      <div id="map-canvas"></div>
    </body>
</html>
