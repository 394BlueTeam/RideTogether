<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">
<html>
    <head>
        <!-- files to be loaded first -->
        <link href='http://fonts.googleapis.com/css?family=Just+Me+Again+Down+Here|Open+Sans' rel='stylesheet' type='text/css' />
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <title>RideTogether</title>
        <script type='application/javascript' src='JS/fastclick.js'></script>
        <link href="CSS/mobile.css" rel="stylesheet" media="handheld,only screen and (max-device-width:480px)" />
        <link href="CSS/core.css" rel="stylesheet" media="screen" />
        <link rel="stylesheet" href="Plugins/FontAwesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="Plugins/Bootstrap/css/bootstrap.min.css">
        <script type="text/javascript" src="Plugins/Bootstrap/js/bootstrap.min.js"></script>
        <!-- <script type="text/javascript" src="test.js"></script> -->
        <script type="text/javascript">
          Parse.initialize("b0jfwJsQkNWPdoKnDgd8KJLufCLWNJpmc5vBTkqr", "X90Jzs3gzKceNOdkFmCle8ZiwsE0HGhyNF4N3Wcj");
            function login(){
                var username = $("input[name=UserNameLogin]").val();
                var password = $("input[name=PasswordLogin]").val();

                Parse.User.logIn(username, password, {
                   success: function(user){
                       console.log("Login succeeded");
                       $('#login').modal('hide');
                       $('#users').html('<p>Welcome, ' + user.get('Name') + '</p>');
                   },
                   error: function(user, error){
                       console.log("Error: ", error);
                   },
                });
            }

            function enroll(){
                // security measure -->
                // check to make sure that the submitted email
                // is a u.northwestern.edu email account
                var email = $("input[name=Email]").val();
                var end = "@u.northwestern.edu";
                var len = email.length;                 // length of inputted email
                var len2 = end.length;                  // length of u.northw.....
                var pos = len - len2;                   // start of slice - the part with @u.....
                var ending = email.slice(pos, len);     // supposed to be the @u.northw.... ending

                if (email == "") {
                    alert('Error: Please enter a @u.northwestern.edu email')
                }

                else if (ending != end) {
                    alert('Error: Please enter a @u.northwestern.edu email')
                }

                else {
                    var password = $("input[name=Password]").val();
                    var name = $("input[name=Name]").val();
                    var cartype = $("input[name=CarType]").val();
                    var homeaddress = $("input[name=HomeAddress]").val();

                    var user = new Parse.User();    
                    user.signUp({username: email, password: password, email: email, 
                                 Name: name, CarType: cartype, HomeAddress: homeaddress,
                                 DriverRating: 0}, {
                        success: function(rideposter){
                            console.log("save succeeded");
                            alert('You\'re registered!');
                            $('#register').modal('hide')
                        },
                        error: function(rideposter, error){
                            console.log("Error: ", error);
                        }
                    });
                }
            }

            window.addEventListener('load', function() {
                FastClick.attach(document.body);
            }, false);

            $(document).ready(function() {
                var currentUser = Parse.User.current();
                if (currentUser) {
                    $('#users').html('<p>Welcome, ' + currentUser.get('Name') + '    ' +
                        '<a href="#" id="logout">Logout</a>' + '</p>');
                    $('#logout').click(Parse.User.logOut());
                } else {
                    $('#users').html('<a href="#" data-toggle="modal" data-target="#register">Don\'t have an account? Register here</a>' +
                                     '    ' + '<a href="#" data-toggle="modal" data-target="#login">Log in</a>');
                }
            });

        </script>
    </head>

    <body>
    	<div class="wrapper">
            <!-- TITLE -->
            <div id="title">
                <span>Ride<span id="cursive">Together</span></span>
                <p>Wanna get away?</p>
            </div>

            <!-- MAIN BUTTONS -->
            <div id="buttons">
                <a href="mvp code/index.html" class="a-btn">
                    <span class="btn-symbol"><i class="fa fa-search fa-lg"></i></span>
                    <span class="btn-text">Find a ride</span> 
                    <span class="sub-text">and request to join</span>
                </a>
                <a href="postride.html" class="a-btn">
                    <span class="btn-symbol"><i class="fa fa-user fa-lg"></i></span>
                    <span class="btn-text">Post a ride</span> 
                    <span class="sub-text">and become a hero</span>
                </a>
                <div id="users">
                    <!--<a href="#" id="small" data-toggle="modal" data-target="#register">Don't have an account? Register here</a> [>this link triggers the signup modal<]-->
                    <!--<a href="#" id="small2" data-toggle="modal" data-target="#login">log in</a> -->
                </div>
            </div>

            <!-- LOGIN MODAL -->
            <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="signin" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <!-- BODY -->
                        <div class="modal-body">
                            <form class="form-horizontal" role="form">
                                <!-- Email -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="usernamelogin" name="UserNameLogin"
                                        placeholder="Email">
                                    </div>
                                </div>

                                <!-- Password -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control" id="passwordlogin" name="PasswordLogin"
                                        placeholder="Password">
                                    </div>
                                </div>

                            </form>
                        </div>

                        <!-- FOOTER -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-default" onclick="login()">login</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIGN UP MODAL -->
            <div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="signup" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <!-- BODY -->
                        <div class="modal-body">
                            <form class="form-horizontal" role="form">
                                <!-- email -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="email" class="form-control" id="email" name="Email" placeholder="Email">
                                    </div>
                                </div>

                                <!-- password -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="password" class="form-control" id="password" name="Password" placeholder="Password">
                                    </div>
                                </div>

                                <!-- name -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="name" name="Name" placeholder="Name">
                                    </div>
                                </div>

                                <!-- car type -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <select class="form-control" id="seats" name="CarType">
                                            <option>Car Type - choose one only if you plan to offer rides</option>
                                            <option>Sedan</option>
                                            <option>Coupe</option>
                                            <option>SUV</option>
                                            <option>Truck</option>
                                        </select>
                                    </div>  
                                </div>

                                <!-- home address -->
                                <div class="form-group">
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="home" name="HomeAddress" placeholder="Home Address">
                                    </div>
                                </div>

                            </form>
                        </div>

                        <!-- FOOTER -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-default" onclick="enroll()">Sign Up</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </body>
</html>
